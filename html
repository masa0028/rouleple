<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>éŸ³å£°ãƒ­ãƒ¼ãƒ—ãƒ¬ï½œã‚ªã‚¤ãƒ«äº¤æ›LP Zoomå•†è«‡ãƒ‡ãƒ¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 12px;
    }
    .app {
      background: #020617;
      border-radius: 16px;
      max-width: 1000px;
      width: 100%;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.4);
    }
    .header {
      padding: 10px 14px;
      border-bottom: 1px solid rgba(148,163,184,0.3);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      background: radial-gradient(circle at top left,#1f2937,#020617);
    }
    .header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .title {
      font-size: 16px;
      font-weight: 600;
    }
    .subtitle {
      font-size: 12px;
      color: #94a3b8;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
      justify-content: center;
    }
    .tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.6);
      color: #bbf7d0;
      background: rgba(22,163,74,0.2);
    }
    .pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
      background: rgba(15,23,42,0.7);
    }

    .char-panel {
      padding: 8px 12px;
      border-bottom: 1px solid rgba(30,64,175,0.5);
      background: #020617;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .char-label {
      font-size: 12px;
      color: #9ca3af;
      margin-right: 4px;
      white-space: nowrap;
    }
    .char-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      padding: 4px 10px;
      font-size: 11px;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s ease, transform 0.1s ease, border-color 0.15s ease;
      white-space: nowrap;
    }
    .char-btn span {
      font-size: 13px;
    }
    .char-btn.active {
      background: #1d4ed8;
      border-color: #60a5fa;
      box-shadow: 0 0 0 1px rgba(59,130,246,0.5);
    }
    .char-desc {
      font-size: 11px;
      color: #9ca3af;
      margin-left: 4px;
      flex: 1;
      min-width: 180px;
    }

    .main {
      display: flex;
      flex: 1;
      min-height: 0;
    }
    .video-area {
      flex: 4;
      display: flex;
      flex-direction: column;
      padding: 10px;
      border-right: 1px solid rgba(30,64,175,0.5);
      background: radial-gradient(circle at top,#111827,#020617 60%);
    }
    .fake-video {
      flex: 1;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.5);
      padding: 10px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      background: radial-gradient(circle at top left,#1f2937,#020617);
    }
    .participant {
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.6);
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg,#020617,#111827);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .participant-avatar {
      width: 60px;
      height: 60px;
      border-radius: 999px;
      border: 2px solid rgba(96,165,250,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      margin-bottom: 6px;
    }
    .participant-label {
      font-size: 11px;
      color: #9ca3af;
    }
    .participant-name {
      position: absolute;
      left: 8px;
      bottom: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      font-size: 11px;
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .controls-bar {
      margin-top: 8px;
      display: flex;
      justify-content: center;
      gap: 10px;
      align-items: center;
    }
    .round-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #e5e7eb;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.1s ease, background 0.1s ease, box-shadow 0.1s ease;
    }
    .round-btn.mic-on {
      background: #059669;
      box-shadow: 0 0 0 2px rgba(16,185,129,0.5);
    }
    .round-btn:hover {
      transform: translateY(-1px);
      background: #1f2933;
    }
    .round-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .mic-hint {
      font-size: 11px;
      color: #9ca3af;
    }

    .chat-area {
      flex: 5;
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 8px;
    }
    .chat-log {
      flex: 1;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.5);
      background: #020617;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }
    .system-msg {
      font-size: 11px;
      color: #94a3b8;
      text-align: center;
    }
    .bubble-row {
      display: flex;
      gap: 6px;
      align-items: flex-end;
    }
    .bubble-row.ai {
      justify-content: flex-start;
    }
    .bubble-row.user {
      justify-content: flex-end;
    }
    .avatar-small {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      flex-shrink: 0;
      background: #020617;
    }
    .bubble {
      max-width: 75%;
      padding: 7px 9px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.4;
      word-break: break-word;
    }
    .bubble.ai {
      background: #0f172a;
      border-bottom-left-radius: 3px;
    }
    .bubble.user {
      background: #2563eb;
      border-bottom-right-radius: 3px;
    }
    .bubble-meta {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .footer {
      padding: 6px 10px 8px;
      border-top: 1px solid rgba(148,163,184,0.3);
      font-size: 11px;
      color: #94a3b8;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .score-pill {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.7);
      color: #bbf7d0;
      background: rgba(22,163,74,0.18);
      font-size: 11px;
    }

    @media (max-width: 900px) {
      .main {
        flex-direction: column;
      }
      .video-area {
        border-right: none;
        border-bottom: 1px solid rgba(30,64,175,0.5);
      }
    }
    @media (max-width: 600px) {
      body {
        padding: 6px;
      }
      .title {
        font-size: 14px;
      }
      .char-panel {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="header-left">
      <div class="title">éŸ³å£°ãƒ­ãƒ¼ãƒ—ãƒ¬ï½œã‚ªã‚¤ãƒ«äº¤æ›LPææ¡ˆ Zoomå•†è«‡ãƒ‡ãƒ¢</div>
      <div class="subtitle">Webã‚µã‚¤ãƒˆä¼šç¤¾ â†’ æ•´å‚™å·¥å ´å‘ã‘ï¼ã‚ªã‚¤ãƒ«äº¤æ›LPæ–°è¦é›†å®¢ææ¡ˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤</div>
    </div>
    <div class="header-right">
      <div class="tag">éŸ³å£°ãƒ¡ã‚¤ãƒ³ãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ­ã‚°ä»˜ã</div>
      <div class="pill">ã‚·ãƒŠãƒªã‚ªï¼šåˆå›ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å•†è«‡ï¼ˆãƒ’ã‚¢ãƒªãƒ³ã‚°ã€œææ¡ˆï¼‰</div>
    </div>
  </div>

  <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š -->
  <div class="char-panel">
    <div class="char-label">ğŸ‘¤ ãƒ­ãƒ¼ãƒ—ãƒ¬ç›¸æ‰‹ï¼ˆæ•´å‚™å·¥å ´å´ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼‰ï¼š</div>

    <button class="char-btn active" data-char-id="smallRural">
      <span>ğŸ¡</span>å°è¦æ¨¡ Ã— åœ°æ–¹ Ã— ç¤¾é•·
    </button>
    <button class="char-btn" data-char-id="mediumSuburban">
      <span>ğŸš—</span>ä¸­è¦æ¨¡ Ã— éƒŠå¤– Ã— å·¥å ´é•·
    </button>
    <button class="char-btn" data-char-id="largeUrban">
      <span>ğŸ™</span>å¤§è¦æ¨¡ Ã— éƒ½å¸‚éƒ¨ Ã— çµ±æ‹¬ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
    </button>

    <div class="char-desc" id="charDesc">
      ç¾åœ¨ï¼šå°è¦æ¨¡ Ã— åœ°æ–¹ Ã— ç¤¾é•·ï½œè·äººè‚Œã§ã¡ã‚‡ã£ã¨ã¶ã£ãã‚‰ã¼ã†ã€‚ã‚³ã‚¹ãƒˆã«å³ã—ã‚ã€‚
    </div>
  </div>

  <div class="main">
    <!-- å·¦ï¼šZoomé¢¨ç”»é¢ï¼‹ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ -->
    <div class="video-area">
      <div class="fake-video">
        <div class="participant">
          <div class="participant-avatar">æ•´</div>
          <div class="participant-label" id="charLabelMain">å°è¦æ¨¡ãƒ»åœ°æ–¹ã®æ•´å‚™å·¥å ´ç¤¾é•·ï¼ˆAIï¼‰</div>
          <div class="participant-name" id="charNameChip">ğŸ§‘â€ğŸ”§ ä½è—¤ç¤¾é•·</div>
        </div>
        <div class="participant">
          <div class="participant-avatar">æ</div>
          <div class="participant-label">Webã‚µã‚¤ãƒˆä¼šç¤¾ï¼ˆã‚ãªãŸãƒ»éŸ³å£°å…¥åŠ›ï¼‰</div>
          <div class="participant-name">ğŸ’¼ ã‚ãªãŸ</div>
        </div>
      </div>
      <div class="controls-bar">
        <button class="round-btn" id="aiSpeakBtn" title="AIï¼ˆæ•´å‚™å·¥å ´å´ï¼‰ã«æ¬¡ã®ã‚»ãƒªãƒ•ã‚’è©±ã•ã›ã‚‹">
          ğŸ§‘â€ğŸ”§
        </button>
        <button class="round-btn" id="micBtn" title="ãƒã‚¤ã‚¯ã§ã‚ãªãŸã®ç™ºè¨€ã‚’éŒ²éŸ³">
          ğŸ¤
        </button>
        <div class="mic-hint" id="micHint">
          ã€ŒğŸ§‘â€ğŸ”§ã€ã§AIãŒè©±ã—ã€ã€ŒğŸ¤ã€ã‚’æŠ¼ã—ã¦ã‹ã‚‰å£°ã§è¿”ç­”ã—ã¦ãã ã•ã„ã€‚
        </div>
      </div>
    </div>

    <!-- å³ï¼šãƒ­ã‚°è¡¨ç¤º -->
    <div class="chat-area">
      <div class="chat-log" id="chatLog">
        <div class="system-msg">
          ãƒ‡ãƒ¢æ‰‹é †ï¼šâ‘  ä¸Šã®ãƒœã‚¿ãƒ³ã§ãƒ­ãƒ¼ãƒ—ãƒ¬ç›¸æ‰‹ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã¶ â†’ â‘¡ã€ŒğŸ§‘â€ğŸ”§ AIã€ãƒœã‚¿ãƒ³ã§åº—é•·å½¹ã®ç™ºè¨€ â†’ â‘¢ã€ŒğŸ¤ ãƒã‚¤ã‚¯ã€ã§ã‚ãªãŸãŒå£°ã§è¿”ç­” â†’ ç¹°ã‚Šè¿”ã—ã€‚
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <div>
      ãƒ’ãƒ³ãƒˆï¼š<br/>
      ãƒ»æœ€åˆã«ã€Œæœ¬æ—¥ã¯ãŠæ™‚é–“ã‚’ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€ã¨æŒ¨æ‹¶<br/>
      ãƒ»èª²é¡Œãƒ’ã‚¢ãƒªãƒ³ã‚° â†’ ã‚ªã‚¤ãƒ«äº¤æ›LPã®ä¾¡å€¤ â†’ äº‹ä¾‹ â†’ ãƒ—ãƒ©ãƒ³ææ¡ˆ ã®æµã‚Œã‚’æ„è­˜
    </div>
    <div id="scoreArea" class="score-pill" style="display:none;"></div>
  </div>
</div>

<script>
  // ===== ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾© =====
  const characters = {
    smallRural: {
      id: "smallRural",
      labelMain: "å°è¦æ¨¡ãƒ»åœ°æ–¹ã®æ•´å‚™å·¥å ´ç¤¾é•·ï¼ˆAIï¼‰",
      nameChip: "ğŸ§‘â€ğŸ”§ ä½è—¤ç¤¾é•·",
      desc: "ç¾åœ¨ï¼šå°è¦æ¨¡ Ã— åœ°æ–¹ Ã— ç¤¾é•·ï½œè·äººè‚Œã§ã¡ã‚‡ã£ã¨ã¶ã£ãã‚‰ã¼ã†ã€‚ã‚³ã‚¹ãƒˆã«å³ã—ã‚ã€‚",
      tone: "casual"
    },
    mediumSuburban: {
      id: "mediumSuburban",
      labelMain: "ä¸­è¦æ¨¡ãƒ»éƒŠå¤–ã®æ•´å‚™å·¥å ´ å·¥å ´é•·ï¼ˆAIï¼‰",
      nameChip: "ğŸ§‘â€ğŸ”§ éˆ´æœ¨å·¥å ´é•·",
      desc: "ç¾åœ¨ï¼šä¸­è¦æ¨¡ Ã— éƒŠå¤– Ã— å·¥å ´é•·ï½œç¾å ´ã¨çµŒå–¶ã®ãƒãƒ©ãƒ³ã‚¹å‹ã€‚è©±ã¯ãã¡ã‚“ã¨èãã‚¿ã‚¤ãƒ—ã€‚",
      tone: "neutral"
    },
    largeUrban: {
      id: "largeUrban",
      labelMain: "å¤§è¦æ¨¡ãƒ»éƒ½å¸‚éƒ¨ã®æ•´å‚™ãƒã‚§ãƒ¼ãƒ³ çµ±æ‹¬ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆAIï¼‰",
      nameChip: "ğŸ§‘â€ğŸ’¼ ç”°ä¸­ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼",
      desc: "ç¾åœ¨ï¼šå¤§è¦æ¨¡ Ã— éƒ½å¸‚éƒ¨ Ã— çµ±æ‹¬ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï½œæ•°å­—ãƒ»åŠ¹ç‡é‡è¦–ã€‚ãƒ­ã‚¸ãƒƒã‚¯ã«æ•æ„Ÿã€‚",
      tone: "formal"
    }
  };

  let currentCharacter = characters.smallRural;

  const charBtns = document.querySelectorAll(".char-btn");
  const charDesc = document.getElementById("charDesc");
  const charLabelMain = document.getElementById("charLabelMain");
  const charNameChip = document.getElementById("charNameChip");

  charBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-char-id");
      currentCharacter = characters[id];
      charBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      charDesc.textContent = currentCharacter.desc;
      charLabelMain.textContent = currentCharacter.labelMain;
      charNameChip.textContent = currentCharacter.nameChip;

      appendSystemMsg(`ãƒ­ãƒ¼ãƒ—ãƒ¬ç›¸æ‰‹ãŒã€Œ${currentCharacter.labelMain}ã€ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸã€‚`);
    });
  });

  // ===== ã‚·ãƒŠãƒªã‚ªï¼ˆãƒˆãƒ¼ãƒ³åˆ¥ï¼‰ =====
  const scenarioSteps = [
    {
      tag: "å°å…¥",
      texts: {
        casual: "ä»Šæ—¥ã¯ã©ã†ã‚‚ã€‚æœ€è¿‘ã€åºƒå‘Šã¨ã‹ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ä¼šç¤¾ã•ã‚“ã‹ã‚‰ã‚ˆãé›»è©±ãŒæ¥ã‚‹ã‚“ã§ã™ã‘ã©ã­ã€æ­£ç›´ã©ã‚Œã‚‚æœ¬å½“ã«åŠ¹æœã‚ã‚‹ã®ã‹åˆ†ã‹ã‚‰ãªãã¦â€¦ã€‚ä»Šæ—¥ã¯ã©ã‚“ãªè©±ãªã‚“ã§ã™ï¼Ÿ",
        neutral: "æœ¬æ—¥ã¯ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚æœ€è¿‘ã€åºƒå‘Šä¼šç¤¾ã•ã‚“ã‚„ITé–¢é€£ã®ä¼šç¤¾ã•ã‚“ã‹ã‚‰ã®ã”ææ¡ˆãŒå¢—ãˆã¦ã„ã¾ã—ã¦ã€ã©ã‚ŒãŒæœ¬å½“ã«åŠ¹æœãŒã‚ã‚‹ã®ã‹è¦‹æ¥µã‚ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚ä»Šå›ã¯ã©ã®ã‚ˆã†ãªå†…å®¹ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
        formal: "æœ¬æ—¥ã¯ãŠæ™‚é–“ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã“ã“æ•°å¹´ã€æ§˜ã€…ãªWebãƒ»ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ä¼šç¤¾ã•ã¾ã‹ã‚‰ã”ææ¡ˆã‚’ã„ãŸã ã„ã¦ã„ã‚‹ã®ã§ã™ãŒã€æŠ•è³‡å¯¾åŠ¹æœãŒèª­ã¿ã«ããã€æ…é‡ã«æ¤œè¨ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚æœ¬æ—¥ã¯ã©ã®ã‚ˆã†ãªã”ææ¡ˆã§ã—ã‚‡ã†ã‹ã€‚"
      }
    },
    {
      tag: "LPã‚¤ãƒ¡ãƒ¼ã‚¸",
      texts: {
        casual: "ã‚ªã‚¤ãƒ«äº¤æ›ã®LPã£ã¦è¨€ã‚ã‚Œã¦ã‚‚ã€æ­£ç›´ãƒ”ãƒ³ã¨æ¥ã¦ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚ãªã‚“ã‹ã‚«ãƒƒã‚³ã„ã„ãƒšãƒ¼ã‚¸ä½œã£ã¦ã‚‚ã‚‰ã£ã¦ã‚‚ã€ã¡ã‚ƒã‚“ã¨ãŠå®¢ã•ã‚“æ¥ã‚‹ã®ã‹ã£ã¦ã„ã†ã®ãŒä¸€ç•ªæ°—ã«ãªã£ã¦ã¦ã€‚",
        neutral: "ã‚ªã‚¤ãƒ«äº¤æ›å‘ã‘ã®LPã¨ä¼ºã„ã¾ã—ãŸãŒã€æ­£ç›´ã€LPã¨è¨€ã‚ã‚Œã¦ã‚‚ã‚ã¾ã‚Šã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã§ãã¦ã„ã¾ã›ã‚“ã€‚è¦‹æ „ãˆãŒè‰¯ãã¦ã‚‚ã€æœ¬å½“ã«æ–°è¦ã®æ–¹ãŒå¢—ãˆã‚‹ã®ã‹ãŒæ°—ã«ãªã£ã¦ã„ã¾ã™ã€‚",
        formal: "ã‚ªã‚¤ãƒ«äº¤æ›LPã¨ã®ã“ã¨ã§ã™ãŒã€ã„ã‚ã‚†ã‚‹ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã®å…·ä½“çš„ãªå½¹å‰²ã‚„ã€æ—¢å­˜ã®ã‚µã‚¤ãƒˆã¨ã®é•ã„ã«ã¤ã„ã¦ã€ã¾ã æ˜ç¢ºãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã¦ã¦ãŠã‚Šã¾ã›ã‚“ã€‚æ–°è¦é›†å®¢ã«ã©ã®ç¨‹åº¦å¯„ä¸ã™ã‚‹ã®ã‹ã‚’çŸ¥ã‚ŠãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚"
      }
    },
    {
      tag: "èª²é¡Œãƒ»æœ¬éŸ³",
      texts: {
        casual: "ã†ã¡ã‚‚æ–°ã—ã„ãŠå®¢ã•ã‚“ã¯å¢—ã‚„ã—ãŸã„ã‚“ã§ã™ã‘ã©ã­ã€ä»Šã¾ã§ãƒãƒ©ã‚·ã¨ã‹ã‚„ã£ã¦ã‚‚æ€ã£ãŸã»ã©åå¿œãŒãªãã¦â€¦ã€‚ã‚ã‚“ã¾ã‚Šåºƒå‘Šè²»ã°ã£ã‹ã‚Šã‹ã‘ã‚‹ã®ã¯æ­£ç›´æ€–ã„ã‚“ã§ã™ã‚ˆã€‚",
        neutral: "æ–°è¦ã®ãŠå®¢æ§˜ã¯å¢—ã‚„ã—ã¦ã„ããŸã„ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¾ã§ãƒãƒ©ã‚·ãªã©ã‚’è©¦ã—ã¦ã‚‚æƒ³å®šã»ã©ã®åå¿œãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ã¾ã‚Šå¤§ããªåºƒå‘Šè²»ã‚’ã‹ã‘ã‚‹ã®ã¯ä¸å®‰ãŒã‚ã‚‹ã®ãŒæœ¬éŸ³ã§ã™ã€‚",
        formal: "æ–°è¦é¡§å®¢ã®ç²å¾—ã¯å¼·åŒ–ã—ãŸã„ãƒ†ãƒ¼ãƒã§ã¯ã‚ã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¾ã§ç´™åª’ä½“ãªã©ã®æ–½ç­–ã§ååˆ†ãªåå¿œãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸçµŒé¨“ã‚‚ã‚ã‚Šã€è²»ç”¨å¯¾åŠ¹æœãŒèª­ã‚ãªã„æ–½ç­–ã«å¤§ããæŠ•è³‡ã™ã‚‹ã“ã¨ã«ã¯æ…é‡ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚"
      }
    },
    {
      tag: "å€¤æ®µä¸å®‰",
      texts: {
        casual: "ã‚ªã‚¤ãƒ«äº¤æ›ã§æ–°è¦ã•ã‚“ãŒæ¥ã‚‹ã®ã¯åˆ†ã‹ã‚‹ã‚“ã§ã™ã‘ã©ã€çµå±€ã¿ã‚“ãªå€¤æ®µã§è¦‹ã¦ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã£ã¦â€¦ã€‚å®‰ã•ã ã‘ã§æ¥ã¦ã€1å›ãã‚Šã§çµ‚ã‚ã£ã¡ã‚ƒã†ã‚“ã˜ã‚ƒãªã„ã‹ãªã£ã¦å¿ƒé…ãªã‚“ã§ã™ã‚ˆã­ã€‚",
        neutral: "ã‚ªã‚¤ãƒ«äº¤æ›ã‚’ãã£ã‹ã‘ã«æ–°è¦ã®æ–¹ãŒæ¥ã‚‰ã‚Œã‚‹ã“ã¨è‡ªä½“ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã¾ã™ã€‚ãŸã ã€ã©ã†ã—ã¦ã‚‚â€œä¾¡æ ¼ã ã‘â€ã§é¸ã°ã‚Œã¦ã—ã¾ã£ã¦ã€ä¸€åº¦ãã‚Šã§çµ‚ã‚ã£ã¦ã—ã¾ã†ã®ã§ã¯ãªã„ã‹ã€ã¨ã„ã†ä¸å®‰ãŒã‚ã‚Šã¾ã™ã€‚",
        formal: "ã‚ªã‚¤ãƒ«äº¤æ›ã‚’å…¥å£ã¨ã—ãŸæ–°è¦é¡§å®¢ç²å¾—ã®è€ƒãˆæ–¹ã¯ç†è§£ã§ãã¾ã™ãŒã€å®Ÿéš›ã«ã¯ä¾¡æ ¼è¨´æ±‚ã®ã¿ã«ãªã£ã¦ã—ã¾ã„ã€å˜ç™ºåˆ©ç”¨ã§çµ‚ã‚ã£ã¦ã—ã¾ã†ã®ã§ã¯ãªã„ã‹ã¨ã„ã†æ‡¸å¿µã‚’æŒã£ã¦ã„ã¾ã™ã€‚"
      }
    },
    {
      tag: "äº‹ä¾‹ç¢ºèª",
      texts: {
        casual: "ã‚‚ã—ä¼¼ãŸã‚ˆã†ãªå·¥å ´ã•ã‚“ã§ã†ã¾ãã„ã£ã¦ã‚‹ã¨ã“ã‚ãŒã‚ã‚‹ãªã‚‰ã€ãã®ä¾‹ã¯ã¡ã‚‡ã£ã¨æ°—ã«ãªã‚Šã¾ã™ã­ã€‚ã–ã£ãã‚Šã§ã„ã„ã‚“ã§ã€ã©ã‚Œãã‚‰ã„åå¿œãŒã‚ã£ãŸã®ã‹æ•™ãˆã¦ã‚‚ã‚‰ãˆã¾ã™ï¼Ÿ",
        neutral: "ã‚‚ã—ã€ã†ã¡ã¨è¦æ¨¡æ„Ÿã‚„åœ°åŸŸæ„ŸãŒè¿‘ã„æ•´å‚™å·¥å ´ã•ã‚“ã§ã®äº‹ä¾‹ãŒã‚ã‚Œã°ã€ãœã²çŸ¥ã‚ŠãŸã„ã§ã™ã€‚ãŠãŠã‚ˆãã§æ§‹ã„ã¾ã›ã‚“ã®ã§ã€ã©ã®ç¨‹åº¦ã®åå¿œãŒã‚ã£ãŸã®ã‹æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ",
        formal: "å½“ç¤¾ã¨è¦æ¨¡æ„Ÿã‚„å•†åœãŒè¿‘ã„æ•´å‚™äº‹æ¥­è€…ã•ã¾ã§ã®å®Ÿç¸¾ãŒã‚ã‚Œã°ã€ãœã²ä¼ºã„ãŸã„ã§ã™ã€‚æ–°è¦ä»¶æ•°ã‚„ç¶™ç¶šç‡ãªã©ã€æ¦‚ç®—å€¤ã§ã‚‚çµæ§‹ã§ã™ã®ã§ã€ã©ã®ç¨‹åº¦ã®æˆæœãŒå‡ºã¦ã„ã‚‹ã®ã‹æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚"
      }
    },
    {
      tag: "è²»ç”¨ãƒ»é‹ç”¨",
      texts: {
        casual: "è©±ã‚’èãé™ã‚Šã€æ‚ªãã¯ãªã•ãã†ã§ã™ã­ã€‚ãŸã ã€ãŠé¡˜ã„ã™ã‚‹ã¨ã—ãŸã‚‰ã€ã©ã‚Œãã‚‰ã„ãŠé‡‘ãŒã‹ã‹ã‚‹ã®ã‹ã¨ã€ã“ã£ã¡å´ã®æ‰‹é–“ãŒã©ã®ãã‚‰ã„å‡ºã‚‹ã®ã‹ã¯ã€ã¡ã‚ƒã‚“ã¨çŸ¥ã£ã¦ãŠããŸã„ã§ã™ã€‚",
        neutral: "ãŠè©±ã‚’ä¼ºã†é™ã‚Šã€å‰å‘ãã«æ¤œè¨ã—ã¦ã‚‚è‰¯ã•ãã†ã ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ãŸã ã€å®Ÿéš›ã«ãŠé¡˜ã„ã™ã‚‹å ´åˆã®è²»ç”¨æ„Ÿã¨ã€ã“ã¡ã‚‰å´ã®é‹ç”¨è² æ‹…ãŒã©ã®ç¨‹åº¦ç™ºç”Ÿã™ã‚‹ã®ã‹ã¯ã€ã—ã£ã‹ã‚ŠæŠŠæ¡ã—ã¦ãŠããŸã„ã§ã™ã€‚",
        formal: "ãŠè©±ã®æ–¹å‘æ€§ã¨ã—ã¦ã¯æ¤œè¨ã«å€¤ã™ã‚‹å°è±¡ã‚’æŒã¡ã¾ã—ãŸã€‚ä¸€æ–¹ã§ã€å°å…¥æ™‚ãƒ»é‹ç”¨æ™‚ãã‚Œãã‚Œã®è²»ç”¨ã¨ã€å½“ç¤¾å´ã«å¿…è¦ã¨ãªã‚‹é‹ç”¨å·¥æ•°ã«ã¤ã„ã¦ã€äº‹å‰ã«å…·ä½“çš„ã«æŠŠæ¡ã—ã¦ãŠããŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚"
      }
    },
    {
      tag: "ã¾ã¨ã‚ä¾é ¼",
      texts: {
        casual: "åˆ†ã‹ã‚Šã¾ã—ãŸã€‚å‰å‘ãã«ã¯è€ƒãˆãŸã„ã®ã§ã€ä»Šæ—¥ã®è©±ã‚’ä¸€åº¦ç¤¾å†…ã§ã‚‚å…±æœ‰ã—ãŸã„ã§ã™ã€‚ã–ã£ãã‚Šã§ã„ã„ã®ã§ã€ã•ã£ãã®ãƒã‚¤ãƒ³ãƒˆã‚’ã¾ã¨ã‚ãŸè³‡æ–™ã‚„ãƒ¡ãƒ¼ãƒ«ã£ã¦ãŠé¡˜ã„ã§ãã¾ã™ï¼Ÿ",
        neutral: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å‰å‘ãã«æ¤œè¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã®ã§ã€ä»Šæ—¥ãŠè©±ã—ã„ãŸã ã„ãŸå†…å®¹ã‚’ã€ç¤¾å†…ã§å…±æœ‰ã§ãã‚‹ã‚ˆã†ç°¡å˜ã«ã¾ã¨ã‚ã¦ã„ãŸã ãã“ã¨ã¯å¯èƒ½ã§ã—ã‚‡ã†ã‹ã€‚",
        formal: "æœ¬æ—¥ã®å†…å®¹ã«ã¤ã„ã¦ã¯å‰å‘ãã«ç¤¾å†…ã§æ¤œè¨ã—ãŸã„ã¨è€ƒãˆã¦ãŠã‚Šã¾ã™ã€‚å·®ã—æ”¯ãˆãªã‘ã‚Œã°ã€æœ¬æ—¥ã”èª¬æ˜ã„ãŸã ã„ãŸãƒã‚¤ãƒ³ãƒˆã‚’æ•´ç†ã—ãŸè³‡æ–™ã€ã‚‚ã—ãã¯è¦ç‚¹ã‚’ã¾ã¨ã‚ãŸãƒ¡ãƒ¼ãƒ«ã‚’ã„ãŸã ãã“ã¨ã¯å¯èƒ½ã§ã—ã‚‡ã†ã‹ã€‚"
      }
    }
  ];

  // ===== DOMå–å¾— =====
  const chatLog = document.getElementById("chatLog");
  const aiSpeakBtn = document.getElementById("aiSpeakBtn");
  const micBtn = document.getElementById("micBtn");
  const micHint = document.getElementById("micHint");
  const scoreArea = document.getElementById("scoreArea");

  // ===== ä¼šè©±çŠ¶æ…‹ =====
  let currentStepIndex = -1;
  let finished = false;
  let userTurns = 0;
  let keywordScore = 0;

  function appendMessage(role, text, meta = "") {
    const row = document.createElement("div");
    row.className = "bubble-row " + (role === "ai" ? "ai" : "user");

    const avatar = document.createElement("div");
    avatar.className = "avatar-small";
    avatar.textContent = role === "ai" ? "æ•´" : "æ";

    const bubbleWrap = document.createElement("div");
    const bubble = document.createElement("div");
    bubble.className = "bubble " + (role === "ai" ? "ai" : "user");
    bubble.textContent = text;

    const metaEl = document.createElement("div");
    metaEl.className = "bubble-meta";
    metaEl.textContent = meta;

    bubbleWrap.appendChild(bubble);
    if (meta) bubbleWrap.appendChild(metaEl);

    if (role === "ai") {
      row.appendChild(avatar);
      row.appendChild(bubbleWrap);
    } else {
      row.appendChild(bubbleWrap);
      row.appendChild(avatar);
    }

    chatLog.appendChild(row);
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  function appendSystemMsg(text) {
    const div = document.createElement("div");
    div.className = "system-msg";
    div.textContent = text;
    chatLog.appendChild(div);
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  // ===== TTSï¼ˆAIãŒè©±ã™ï¼‰ =====
  function speakText(text) {
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = "ja-JP";
    uttr.rate = 1.02;
    uttr.pitch = 1.0;
    window.speechSynthesis.speak(uttr);
  }

  function getCurrentTone() {
    return currentCharacter.tone || "neutral";
  }

  function nextAiLine() {
    if (finished) return;

    if (currentStepIndex >= scenarioSteps.length - 1) {
      // ã‚·ãƒŠãƒªã‚ªçµ‚äº†å¾Œã®ä¸€è¨€
      const closing = "æœ¬ã‚·ãƒŠãƒªã‚ªã®AIå´ã®æƒ³å®šè³ªå•ã¯ã“ã“ã¾ã§ã§ã™ã€‚æœ€å¾Œã«ã€ä»Šæ—¥ã®ã”ææ¡ˆå†…å®¹ã‚’ä¸€è¨€ã§ã¾ã¨ã‚ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚";
      appendMessage("ai", closing, `${currentCharacter.labelMain}`);
      speakText(closing);
      finished = true;
      showScoreHint();
      return;
    }

    currentStepIndex++;
    const step = scenarioSteps[currentStepIndex];
    const tone = getCurrentTone();
    const text = step.texts[tone] || step.texts.neutral;
    appendMessage("ai", text, `${currentCharacter.labelMain}ï½œãƒ•ã‚§ãƒ¼ã‚ºï¼š${step.tag}`);
    speakText(text);
  }

  // ===== éŸ³å£°èªè­˜ï¼ˆã‚ãªãŸã®ç™ºè¨€ï¼‰ =====
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  let recognition = null;
  let recognizing = false;

  if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = "ja-JP";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = () => {
      recognizing = true;
      micBtn.classList.add("mic-on");
      micHint.textContent = "èªè­˜ä¸­â€¦ è©±ã—çµ‚ã‚ã£ãŸã‚‰æ•°ç§’å¾…ã¤ã¨è‡ªå‹•ã§æ­¢ã¾ã‚Šã¾ã™ã€‚";
    };

    recognition.onend = () => {
      recognizing = false;
      micBtn.classList.remove("mic-on");
      micHint.textContent = "ã€ŒğŸ§‘â€ğŸ”§ã€ã§AIã«è©±ã•ã›ã€ã€ŒğŸ¤ã€ã§ã‚ãªãŸã®è¿”ç­”ã‚’éŸ³å£°å…¥åŠ›ã§ãã¾ã™ã€‚";
    };

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript.trim();
      if (transcript) {
        handleUserSpeech(transcript);
      }
    };

    recognition.onerror = (event) => {
      recognizing = false;
      micBtn.classList.remove("mic-on");
      micHint.textContent = "éŸ³å£°èªè­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ã€ŒğŸ¤ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿åˆ©ç”¨å¯èƒ½ï¼‰";
    };
  } else {
    micBtn.classList.add("disabled");
    micHint.textContent = "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeãªã©ã§ãŠè©¦ã—ãã ã•ã„ã€‚";
  }

  function handleUserSpeech(text) {
    appendMessage("user", text, "ã‚ãªãŸï¼ˆWebã‚µã‚¤ãƒˆä¼šç¤¾ï¼‰ï½œéŸ³å£°å…¥åŠ›");
    userTurns++;

    // ç°¡æ˜“ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ï¼ãƒ‡ãƒ¢ç”¨ï¼‰
    if (text.includes("ã‚ªã‚¤ãƒ«äº¤æ›")) keywordScore += 1;
    if (text.includes("LP") || text.includes("ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°")) keywordScore += 1;
    if (text.includes("æ–°è¦") || text.includes("é›†å®¢")) keywordScore += 1;
    if (text.includes("äº‹ä¾‹") || text.includes("å®Ÿç¸¾")) keywordScore += 1;
    if (text.includes("ãƒ—ãƒ©ãƒ³") || text.includes("ãƒ†ã‚¹ãƒˆ")) keywordScore += 1;
    if (text.includes("ã¾ãšã¯") || text.includes("ãŠè©¦ã—")) keywordScore += 1;

    if (finished) {
      showFinalScoreIfReady();
    } else {
      appendSystemMsg("ğŸ‘‰ å¿…è¦ã«å¿œã˜ã¦ã€ŒğŸ§‘â€ğŸ”§ AIã€ãƒœã‚¿ãƒ³ã§ã€æ¬¡ã®è³ªå•ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€²ã‚ã¦ãã ã•ã„ã€‚");
    }
  }

  micBtn.addEventListener("click", () => {
    if (!recognition || micBtn.classList.contains("disabled")) return;

    if (!recognizing) {
      try {
        recognition.start();
      } catch (e) {
        // é€£æ‰“å¯¾ç­–
      }
    } else {
      recognition.stop();
    }
  });

  aiSpeakBtn.addEventListener("click", nextAiLine);

  function showScoreHint() {
    appendSystemMsg("ã‚·ãƒŠãƒªã‚ªã¯ã²ã¨é€šã‚Šçµ‚äº†ã—ã¾ã—ãŸã€‚æœ€å¾Œã«ä¸€è¨€ã€ä»Šæ—¥ã®ææ¡ˆã®ãƒã‚¤ãƒ³ãƒˆã‚’ã¾ã¨ã‚ã¦è©±ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãã®å†…å®¹ã‚’å…ƒã«ä»®ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚");
  }

  function showFinalScoreIfReady() {
    if (userTurns < 3) return;
    let score = 60 + keywordScore * 8;
    if (score > 98) score = 98;

    let rank = "Bronze";
    if (score >= 85) rank = "Gold";
    else if (score >= 75) rank = "Silver";

    scoreArea.style.display = "inline-flex";
    scoreArea.textContent = `ä»®è©•ä¾¡ï¼š${score}ç‚¹ ï¼ ãƒ©ãƒ³ã‚¯ï¼š${rank}ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰`;

    appendSystemMsg("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¾‹ï¼šèª²é¡Œãƒ’ã‚¢ãƒªãƒ³ã‚° â†’ ã‚ªã‚¤ãƒ«äº¤æ›LPã®ä¾¡å€¤èª¬æ˜ â†’ äº‹ä¾‹ â†’ ãƒ—ãƒ©ãƒ³ææ¡ˆã€ã®æµã‚ŒãŒã§ãã¦ã„ãŸã‹ã‚’æŒ¯ã‚Šè¿”ã£ã¦ã¿ã¦ãã ã•ã„ã€‚æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ã“ã“ã«ã‚ˆã‚Šè©³ç´°ãªAIã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ã€‚");
  }

  // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  appendSystemMsg("ã“ã‚Œã¯ãƒ‡ãƒ¢ç’°å¢ƒã§ã™ã€‚ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸ã‚“ã§ã‹ã‚‰ã€ŒğŸ§‘â€ğŸ”§ã€ã§AIã«è©±ã‚’ã•ã›ã€ã€ŒğŸ¤ã€ã§ã‚ãªãŸãŒå£°ã§è¿”ç­”ã™ã‚‹æµã‚Œã§ãƒ­ãƒ¼ãƒ—ãƒ¬ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚");
</script>
</body>
</html>
